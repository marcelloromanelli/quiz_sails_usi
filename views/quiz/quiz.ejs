<!DOCTYPE HTML>

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title><%= title %></title>

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/socket.io.js"></script>
    <script type="text/javascript" src="/js/sails.io.js"></script>
    <script type="text/javascript" src="/js/app.js"></script>

    <script src="/js/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="/js/jquery.ui.touch-punch.min.js"></script>
    <script src="/js/bootstrap-select.js"></script>
    <script src="/js/bootstrap-switch.js"></script>
    <script src="/js/flatui-checkbox.js"></script>
    <script src="/js/flatui-radio.js"></script>
    <script src="/js/jquery.tagsinput.js"></script>
    <script src="/js/jquery.placeholder.js"></script>
    <script src="/js/jquery.stacktable.js"></script>

    <script src="/js/intro.js"></script>

	<link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/css/flat-ui.css" rel="stylesheet">
    <link href="/css/introjs.css" rel="stylesheet">
    <link href="/css/introjs-rtl.css" rel="stylesheet">

    <style type="text/css">
        body {
            background: #eee;
        }

        .progress {
            border:1px solid white;
            height:45px;
        }

        #regolamentoButton, #question {
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
        }

        #tutorial, #emailBox, #bestBox, #dailyTry {
            width: 500px;
            height: 70px;
            text-align: center;
            vertical-align: middle;
            display: table-cell;
        }

        #emailBox, #bestBox, #dailyTry, #rules, #answer1, #answer2 {
            background-color: #bbb;
        }

        #prizebar {
            line-height: 40px;
        }

        #question, #regolamentoButton {
            height:100px;
        }

        #regolamentoButton {
            width: 580px;
            text-align: center;
            vertical-align: middle;
            display: table-cell;
        }


        #rules, #answer1, #answer2 {
            height: 580px;
        }

        #rules {
            width: 500px;
            text-align: center;
            vertical-align: middle;
            display: table-cell;
        }

        #question {
            font-family: "Lato", sans-serif;
            font-size: 30px;
            line-height:1;

            width:2000px;
            text-align: center;
            vertical-align: middle;
            display: table-cell;
            opacity: 1;

            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
        }

        #answer1, #answer2 {
            font-family: "Lato", sans-serif;
            font-size: 30px;
            line-height:1;

            width:2000px;
            text-align: center;
            vertical-align: middle;
            display: table-cell;

            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
        }

        #answer1, #answer2, #tutorial {
            background-color: #f76c5c;
            border: 1px solid gray;
            box-shadow: 3px 3px 3px #aaa;
            opacity: 1;
        }

        #difficultyLevel {
            height: 70px;
            text-align: center;
        }

        #level1, #level2, #level3, #level4, #level5, #level6 {
            width: 80px;
            margin-top: 0px;
            padding: 0px;
            display: inline-block;
        }

        #level1 {
            height: 20px;
            line-height: 20px;
        }

        #level2 {
            height: 30px;
            line-height: 30px;
        }

        #level3 {
            height: 40px;
            line-height: 40px;
        }

        #level4 {
            height: 50px;
            line-height: 50px;
        }

        #level5 {
            height: 60px;
            line-height: 60px;
        }

        #level6 {
            height: 70px;
            line-height: 70px;
        }

    </style>
</head>

<body>
    <div class="container-fluid" style="margin-top:35px;">
        <div class="row-fluid">
            <div class="span2">
                <div class="row-fluid" style="margin-bottom: 15px;">
                    <a id="tutorial" class="btn btn-large btn-block btn-primary" onclick="javascript:introJs().start();"><%= res.i18n({phrase: 'quiz_tutorial', locale: lang}) %></a>
                </div>

                <div class="row-fluid" style="margin-bottom: 5px;">
                    <a class="btn btn-large btn-block btn-primary" id="emailBox">
                        <%= res.i18n({phrase: 'quiz_email', locale: lang}) %>
                        <span id="email"><%= " " + gamer.email%></span>
                    </a>
                </div>

                <div class="row-fluid" style="margin-bottom: 5px;">
                    <a class="btn btn-large btn-block btn-primary" id="emailBox">
                        <%= res.i18n({phrase: 'quiz_best', locale: lang}) %>
                        <span id="best"><%= " " + gamer.best%></span>
                    </a>
                </div>

                <div class="row-fluid"">
                    <a class="btn btn-large btn-block btn-primary" id="dailyTry">
                        <%= res.i18n({phrase: 'quiz_dailyTry', locale: lang}) %>
                        <span id="daily"><%= " "%></span>
                    </a>
                </div>
            </div>

            <div class="span10">
                <div class="row-fluid">
                    <div class="span12">
                        <div class="progress" data-step="1" data-intro="ciao">
                            <div class="bar bar-success" id="prizebar" style="font-size:140%; width: 33.33333333333333%;"> <span id="isPrize1" class="<%= (gamer.prize1)?"fui-check":"fui-cross" %>"></span><span style="font-size:110%"><%= res.i18n({phrase: 'quiz_prize1', locale: lang}) %></span></div>
                            <div class="bar bar-success" id="prizebar" style="font-size:140%; width: 33.33333333333333%;border-right:1px solid white; border-left:1px solid white"><span id="isPrize2" class="<%= (gamer.prize2)?"fui-check":"fui-cross" %>"></span><span style="font-size:110%"><%= res.i18n({phrase: 'quiz_prize2', locale: lang}) %></span></div>
                            <div class="bar bar-success" id="prizebar" style="font-size:140%; width: 33.33333333333333%;"><span id="isPrize3" class="<%= (gamer.prize3)?"fui-check":"fui-cross" %>"></span><span style="font-size:110%"><%= res.i18n({phrase: 'quiz_prize3', locale: lang}) %></span></div>
                       </div>
                    </div>
                </div>

                <div class="row-fluid" style="margin-bottom: 20px;">
                    <div class="span12">
                        <div class="progress" data-step="2" data-intro="ciao ancora">
                            <div id="score10" class="bar bar-success" style="background-color: #2ECC71; width: 0%;"></div>
                            <div id="score20" class="bar bar-success" style="background-color: #F1C40F; width: 0%;"></div>
                            <div id="score30" class="bar bar-success" style="background-color: #E67E22; width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <div class="row-fluid">
                   <div class="span12" style="text-align:center;">
                        <h4 style="display:inline"><%= res.i18n({phrase: 'quiz_questionNumber', locale: lang}) %></h4> <h4 style="display:inline" id="questionNumber"></h4>
                   </div>
                </div>

                <div class="row-fluid">
                   <div class="span12" style="text-align:center;">
                        <h4><%= res.i18n({phrase: 'quiz_difficulty', locale: lang}) %></h4>
                   </div>
                </div>

                <div class="row-fluid" style="margin-bottom:30px">
                    <div class="span12">
                        <div id="difficultyLevel">
                            <a id="level1" class="btn btn-large btn-block btn-primary">1</a>
                            <a id="level2" class="btn btn-large btn-block btn-primary">2</a>
                            <a id="level3" class="btn btn-large btn-block btn-primary">3</a>
                            <a id="level4" class="btn btn-large btn-block btn-primary">4</a>
                            <a id="level5" class="btn btn-large btn-block btn-primary">5</a>
                            <a id="level6" class="btn btn-large btn-block btn-primary">6 </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span2">
                <div class="row-fluid" style="margin-bottom: 20px;">
                    <a class="btn btn-large btn-block btn-primary" id="regolamentoButton">
                        <%= res.i18n({phrase: 'quiz_ruleTitle', locale: lang}) %>
                    </a>
                </div>

                <div class="row-fluid">
                    <div class="row-fluid" style="margin-bottom: 20px;">
                        <a class="btn btn-large btn-block btn-primary" id="rules">
                            <%= res.i18n({phrase: 'quiz_rules', locale: lang}) %>
                        </a>
                    </div>
                </div>
            </div>

            <div class="span10">
                <div class="row-fluid" style="margin-bottom: 20px;">
                    <div class="span12">
                        <a class="btn btn-large btn-block btn-primary" id="question"></a>
                    </div>
                </div>

                <div class="row-fluid" style="margin-bottom: 20px;">
                    <div class="span6">
                        <a class="btn btn-large btn-block btn-primary" id="answer1" ></a>
                    </div>

                    <div class="span6">
                        <a class="btn btn-large btn-block btn-primary" id="answer2" ></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function() {
            loadQuestion()

            if(firstTime) {
                introJs().start()

                var update = {
                    id: idGamer,
                    firstLogin: false
                }

                socket.request('/gamer/update', update, function(res) {
                    //error
                })
            }

            $('#answer1').click(function () {
                checkQuestion(0)
            })

            $('#answer2').click(function () {
                checkQuestion(1)
            })
        });

        var currentCorrect = 0;
        var questions = <%- JSON.stringify(questions)%>

        var firstTime = <%= gamer.firstLogin %>
        var prize1 = <%= gamer.prize1%>
        var prize2 = <%= gamer.prize2%>
        var prize3 = <%= gamer.prize3%>
        var idGamer = <%= gamer.id%>
        var forFun =  <%= forFun%>
        var best = <%= " " + gamer.best%>
        var current = 0
        var max = <%= numberQuestions%>
        var step = 100 / max

        var loadQuestion = function() {
            $("#questionNumber").html('&nbsp;' + (current + 1) + '/' + 30)
            $('#question').html(questions[current].question)

            var level = questions[current].level
            $('#level1').css('background-color', '#bbb')
            $('#level2').css('background-color', '#bbb')
            $('#level3').css('background-color', '#bbb')
            $('#level4').css('background-color', '#bbb')
            $('#level5').css('background-color', '#bbb')
            $('#level6').css('background-color', '#bbb')

            if(level >= 1)
                $('#level1').css('background-color', '#2ECC71')
            if(level >= 2)
                $('#level2').css('background-color', '#2ECC71')
            if(level >= 3)
                $('#level3').css('background-color', '#F1C40F')
            if(level >= 4)
                $('#level4').css('background-color', '#F1C40F')
            if(level >= 5)
                $('#level5').css('background-color', '#E67E22')
            if(level >= 6)
                $('#level6').css('background-color', '#E67E22')

            currentCorrect =  Math.floor(Math.random()*2)
            if(currentCorrect == 0) {
                $('#answer1').html(questions[current].correct)
                $('#answer2').html(questions[current].wrong)
            } else {
                $('#answer1').html(questions[current].wrong)
                $('#answer2').html(questions[current].correct)
            }
        }

        var checkQuestion = function(button) {
            if(currentCorrect == button) {
                progressUpdate()
                if(current > max) {
                    //TODO
                } else {
                    loadQuestion()
                }
            } else {

            }
        }

        var add10 = function() {
            var size = current * step
            $('#score10').css('width', size + '%')
        }

        var add20 = function() {
            var size = (current - 10) * step
            $('#score20').css('width', size + '%')
        }

        var add30 = function() {
            var size = (current - 20) * step
            $('#score30').css('width', size + '%')
        }

        var progressUpdate = function() {
            current++
            if(current <= max) {
                if(current < 11) {
                    add10()
                } else if(current < 21) {
                    add20()
                } else {
                    add30()
                    if(current == 30) {
                        //TODO
                    }
                }
            }

            if(!forFun) {
                if(current >= 10 || prize1) {
                    prize1 = true
                    $('#isPrize1').removeClass('fui-check fui-cross').addClass('fui-check')
                }

                if(current >= 20 || prize2) {
                    prize2 = true
                    $('#isPrize2').removeClass('fui-check fui-cross').addClass('fui-check')
                }

                if(current >= 30 || prize3) {
                    prize3 = true
                    $('#isPrize3').removeClass('fui-check fui-cross').addClass('fui-check')
                }

                if(current > best) {
                    best = current
                    $('#best').html(best)
                }

                var update = {
                    id: idGamer,
                    prize1: prize1,
                    prize2: prize2,
                    prize3: prize3,
                    best: best
                }

                socket.request('/gamer/update', update, function(res) {
                    //error
                })
            }
        }
   </script>

</body>
</html>